<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Para Ti ❤️ Con Amor Infinito</title>
  
  <!-- Tailwind CSS para un diseño moderno y adaptable -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Biblioteca para animaciones 3D -->
  <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
      }
    }
  </script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    /* Usamos Poppins como fuente base y Dancing Script para los títulos */
    body {
      font-family: 'Poppins', sans-serif;
    }
    .font-title {
      font-family: 'Dancing Script', cursive;
    }
    
    /* Estilos para el fondo 3D */
    #bg-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    /* Efecto de desenfoque de fondo para los popups */
    .backdrop-blur-lg {
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }
    
    /* Animación de entrada para los elementos */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in {
      animation: fadeIn 0.8s ease-out forwards;
    }
    
    /* Estilos personalizados para el scrollbar en el popup */
    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(255, 105, 180, 0.6);
      border-radius: 10px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 105, 180, 0.8);
    }
    .dark .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(96, 165, 250, 0.6);
    }
    .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: rgba(96, 165, 250, 0.8);
    }
  </style>
</head>
<body class="bg-gray-900 text-white overflow-hidden transition-colors duration-500">

  <!-- Canvas para la animación 3D de fondo -->
  <canvas id="bg-canvas"></canvas>

  <!-- Contenedor principal -->
  <main id="main-content" class="relative min-h-screen flex flex-col items-center justify-center p-4 transition-opacity duration-1000">
    
    <div class="text-center z-10 p-6 max-w-2xl w-full">
      <!-- Título principal con animación de entrada -->
      <h1 class="font-title text-6xl md:text-8xl text-pink-300 drop-shadow-lg fade-in" style="animation-delay: 200ms;">Jirafa y Pinguina</h1>
      <p class="mt-4 text-lg md:text-xl text-gray-300 fade-in" style="animation-delay: 400ms;">Una pequeña carta para recordarte lo mucho que te pienso...</p>

      <!-- Contenedor de botones con animación -->
      <div class="mt-8 flex flex-wrap justify-center gap-4 fade-in" style="animation-delay: 600ms;">
        <button onclick="showLetter()" class="group relative inline-flex items-center justify-center px-6 py-3 bg-pink-500 hover:bg-pink-600 text-white font-semibold rounded-full shadow-lg transition-transform transform hover:scale-105 duration-300">
          <svg class="w-5 h-5 mr-2 -ml-1 transition-transform group-hover:rotate-[-5deg]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 18H4V8L12 13L20 8V18ZM12 11L4 6H20L12 11Z"/></svg>
          Abrir Carta
        </button>
        <button onclick="toggleTheme()" class="group relative inline-flex items-center justify-center px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-full shadow-lg transition-transform transform hover:scale-105 duration-300">
          <svg id="theme-icon" class="w-5 h-5 mr-2 -ml-1 transition-transform group-hover:rotate-[15deg]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 010 1.06l-1.591 1.59a.75.75 0 11-1.06-1.06l1.59-1.59a.75.75 0 011.06 0zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5h2.25a.75.75 0 01.75.75zM17.836 17.836a.75.75 0 01-1.06 0l-1.59-1.591a.75.75 0 111.06-1.06l1.59 1.59a.75.75 0 010 1.06zM12 21.75a.75.75 0 01-.75-.75v-2.25a.75.75 0 011.5 0v2.25a.75.75 0 01-.75.75zM5.164 17.836a.75.75 0 010-1.06l1.59-1.591a.75.75 0 111.06 1.06l-1.59 1.59a.75.75 0 01-1.06 0zM3 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3.75A.75.75 0 013 12zM6.106 5.106a.75.75 0 011.06 0l1.591 1.59a.75.75 0 01-1.06 1.06l-1.59-1.591a.75.75 0 010-1.06z"/></svg>
          Modo Claro
        </button>
      </div>
    </div>
  </main>
  
  <!-- Popup para la carta -->
  <div id="letter-popup" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-lg flex items-center justify-center p-4 z-50 hidden opacity-0 transition-opacity duration-300">
    <div id="letter-card" class="bg-gray-800 bg-opacity-80 border border-gray-700 rounded-2xl shadow-2xl max-w-2xl w-full text-white transform scale-95 transition-all duration-300">
      <div class="p-6 md:p-8">
        <h2 class="font-title text-4xl text-center text-pink-300 mb-6">Mi Carta para Ti</h2>
        <div id="letter-content" class="custom-scrollbar text-left text-gray-300 leading-relaxed max-h-[50vh] overflow-y-auto pr-4">
          <p>Cargando...</p>
        </div>
      </div>
      <div class="px-6 pb-6 flex justify-between items-center">
        <button onclick="closeLetter()" class="text-gray-400 hover:text-white transition-colors">Cerrar</button>
        <button id="next-button" onclick="nextPart()" class="px-5 py-2 bg-pink-500 hover:bg-pink-600 text-white font-semibold rounded-full shadow-lg transition-transform transform hover:scale-105 duration-300">Siguiente</button>
      </div>
    </div>
  </div>
  
  <!-- Popup para el mensaje final -->
  <div id="final-message-popup" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-lg flex items-center justify-center p-4 z-50 hidden opacity-0 transition-opacity duration-300">
      <div class="bg-gray-800 bg-opacity-80 border border-gray-700 rounded-2xl shadow-2xl max-w-md w-full text-center p-8 text-white transform scale-95 transition-all duration-300">
          <div id="final-heart" class="text-6xl text-pink-500 mb-4 transition-transform duration-500 transform scale-0">❤️</div>
          <p class="text-xl text-gray-200">Gracias por leer esta carta, lo hice con mucho amor.</p>
          <button onclick="closeFinalMessage()" class="mt-6 px-5 py-2 bg-pink-500 hover:bg-pink-600 text-white font-semibold rounded-full shadow-lg transition-transform transform hover:scale-105 duration-300">Cerrar</button>
      </div>
  </div>


  <!-- Script Principal -->
  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    // --- CONFIGURACIÓN DE LA ESCENA 3D ---
    let camera, scene, renderer, heartMesh, particlesMesh;
    const body = document.querySelector('body');

    function init3D() {
      // Cámara
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 5;

      // Escena
      scene = new THREE.Scene();

      // Renderizador
      renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg-canvas'), alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

      // Corazón 3D
      createHeart();
      
      // Sistema de partículas
      createParticles();

      // Luces
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
      scene.add(ambientLight);
      const pointLight = new THREE.PointLight(0xffffff, 1);
      pointLight.position.set(5, 5, 5);
      scene.add(pointLight);

      animate();
    }

    function createHeart() {
      const shape = new THREE.Shape();
      const x = -2.5, y = -5;
      shape.moveTo(x + 2.5, y + 2.5);
      shape.bezierCurveTo(x + 2.5, y + 2.5, x + 2, y, x, y);
      shape.bezierCurveTo(x - 3, y, x - 3, y + 3.5, x - 3, y + 3.5);
      shape.bezierCurveTo(x - 3, y + 5.5, x - 1.5, y + 7.7, x + 2.5, y + 9.5);
      shape.bezierCurveTo(x + 6, y + 7.7, x + 8, y + 5.5, x + 8, y + 3.5);
      shape.bezierCurveTo(x + 8, y + 3.5, x + 8, y, x + 5, y);
      shape.bezierCurveTo(x + 3.5, y, x + 2.5, y + 2.5, x + 2.5, y + 2.5);

      const extrudeSettings = {
        steps: 2,
        depth: 1,
        bevelEnabled: true,
        bevelThickness: 0.5,
        bevelSize: 0.5,
        bevelSegments: 2,
      };

      const geometry = new THREE.ExtrudeGeometry(shape, extrudeSettings);
      geometry.center();
      const material = new THREE.MeshStandardMaterial({
        color: 0xff4f81,
        metalness: 0.3,
        roughness: 0.4,
      });
      heartMesh = new THREE.Mesh(geometry, material);
      heartMesh.scale.set(0.1, 0.1, 0.1);
      scene.add(heartMesh);
    }
    
    function createParticles() {
        const particlesGeometry = new THREE.BufferGeometry;
        const count = 5000;
        
        const positions = new Float32Array(count * 3);
        
        for(let i=0; i < count * 3; i++) {
            positions[i] = (Math.random() - 0.5) * 20;
        }
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        
        const particlesMaterial = new THREE.PointsMaterial({
            size: 0.02,
            sizeAttenuation: true,
            color: 0xffffff,
            transparent: true,
            opacity: 0.7
        });
        
        particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);
    }

    // --- ANIMACIÓN ---
    const clock = new THREE.Clock();
    function animate() {
      const elapsedTime = clock.getElapsedTime();
      
      // Animar corazón
      if (heartMesh) {
        heartMesh.rotation.y = elapsedTime * 0.2;
        heartMesh.rotation.x = Math.sin(elapsedTime * 0.5) * 0.1;
        heartMesh.position.y = Math.sin(elapsedTime * 0.7) * 0.1;
      }
      
      // Animar partículas
      if (particlesMesh) {
          particlesMesh.rotation.y = elapsedTime * 0.05;
      }
      
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }

    // --- MANEJO DE LA CARTA ---
    const letterParts = [
      "Amor,",
      "No te amo por tu físico, aunque eres hermosa… te amo por todo lo que eres, por esa forma de existir que me tocó el corazón y ya no me dejó ser el mismo.",
      "Te amo porque, aún con tus silencios, sigues siendo lo más apreciado que tengo.",
      "Te amo, aunque no lo notes, aunque no me preguntes, aunque no parezca que te importe.",
      "Sigo aquí, contigo en el alma, pensándote en cada gesto, esperando en cada día una señal tuya que me diga que aún me llevas en ti.",
      "Si tan solo supieras cuánto me importas, cuánto me haces falta, cuánto daría por tenerte, por no perderte.",
      "Si tan solo supieras que aún te sigo amando... con todo, a pesar de todo, y contigo, siempre contigo…",
      "Sé que no soy perfecto, pero quiero ser todo lo que sueñas. Quiero que me digas qué te gusta: qué te hace reír, qué te hace sentir segura. Enséñame cómo amarte de la manera en que quieres ser amada. Tu felicidad significa mucho para mí, y nunca dejaré de intentar ser la persona que te la brinde. Quiero ser quien esté ahí para ti, quien lo haga bien, quien aprenda de sus errores. Siempre estaré dispuesto a crecer, a cambiar y a amarte más profundamente que ayer. Cuéntame tus sueños, tus deseos, tus miedos, y te prometo que estaré aquí. Mereces ser amada de una forma que se sienta bien para ti, y yo estoy aquí, dispuesto a hacer lo que sea necesario para ser esa persona para ti. Así que solo sé que te amo."
    ];
    let currentPart = 0;
    const letterPopup = document.getElementById('letter-popup');
    const letterCard = document.getElementById('letter-card');
    const letterContent = document.getElementById('letter-content');
    const nextButton = document.getElementById('next-button');
    const finalMessagePopup = document.getElementById('final-message-popup');
    const finalHeart = document.getElementById('final-heart');

    function typeText(text) {
      let i = 0;
      letterContent.innerHTML = '';
      const interval = setInterval(() => {
        if (i < text.length) {
          letterContent.innerHTML += text.charAt(i);
          i++;
          letterContent.scrollTop = letterContent.scrollHeight;
        } else {
          clearInterval(interval);
        }
      }, 25);
    }

    window.showLetter = () => {
      currentPart = 0;
      letterPopup.classList.remove('hidden');
      document.getElementById('main-content').classList.add('opacity-0', 'pointer-events-none');
      setTimeout(() => {
        letterPopup.classList.remove('opacity-0');
        letterCard.classList.remove('scale-95');
        typeText(letterParts[currentPart]);
        nextButton.textContent = 'Siguiente';
        nextButton.style.display = 'block';
      }, 50);
    }

    window.closeLetter = () => {
      letterPopup.classList.add('opacity-0');
      letterCard.classList.add('scale-95');
      document.getElementById('main-content').classList.remove('opacity-0', 'pointer-events-none');
      setTimeout(() => letterPopup.classList.add('hidden'), 300);
    }

    window.nextPart = () => {
      currentPart++;
      if (currentPart < letterParts.length) {
        letterContent.classList.add('opacity-0');
        setTimeout(() => {
          typeText(letterParts[currentPart]);
          letterContent.classList.remove('opacity-0');
          letterContent.scrollTop = 0;
        }, 300);
        if (currentPart === letterParts.length - 1) {
            nextButton.textContent = 'Finalizar';
        }
      } else {
        closeLetter();
        setTimeout(showFinalMessage, 300);
      }
    }

    function showFinalMessage() {
      finalMessagePopup.classList.remove('hidden');
      setTimeout(() => {
        finalMessagePopup.classList.remove('opacity-0');
        finalMessagePopup.querySelector('div').classList.remove('scale-95');
        setTimeout(() => {
          finalHeart.classList.remove('scale-0');
          finalHeart.classList.add('transform', 'scale-100');
        }, 200);
      }, 50);
    }
    
    window.closeFinalMessage = () => {
      finalMessagePopup.classList.add('opacity-0');
      finalMessagePopup.querySelector('div').classList.add('scale-95');
      setTimeout(() => finalMessagePopup.classList.add('hidden'), 300);
    }

    // --- MODO CLARO / OSCURO ---
    window.toggleTheme = () => {
      body.classList.toggle('dark');
      const isDark = body.classList.contains('dark');
      const themeIcon = document.getElementById('theme-icon');
      
      // Cambiar colores del corazón y fondo
      const newHeartColor = isDark ? 0x60a5fa : 0xff4f81; // Azul en modo oscuro, rosa en claro
      const newParticleColor = isDark ? 0x93c5fd : 0xffffff;
      
      heartMesh.material.color.setHex(newHeartColor);
      particlesMesh.material.color.setHex(newParticleColor);
      
      // Cambiar fondo del body
      body.style.backgroundColor = isDark ? '#f0f9ff' : '#111827';
      
      // Actualizar texto y estilos de la UI
      document.querySelector('h1').classList.toggle('text-pink-300', !isDark);
      document.querySelector('h1').classList.toggle('text-blue-500', isDark);
      document.querySelectorAll('button').forEach(b => {
        if(b.textContent.includes('Carta')) {
          b.classList.toggle('bg-pink-500', !isDark);
          b.classList.toggle('hover:bg-pink-600', !isDark);
          b.classList.toggle('bg-blue-500', isDark);
          b.classList.toggle('hover:bg-blue-600', isDark);
        }
      });
      document.querySelector('p').classList.toggle('text-gray-300', !isDark);
      document.querySelector('p').classList.toggle('text-gray-600', isDark);

      themeIcon.innerHTML = isDark 
        ? `<path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 004.463-.948.75.75 0 01.981.632A11.25 11.25 0 0112 21a11.25 11.25 0 01-9.472-16.592.75.75 0 01.819-.162z" clip-rule="evenodd" />` 
        : `<path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 010 1.06l-1.591 1.59a.75.75 0 11-1.06-1.06l1.59-1.59a.75.75 0 011.06 0zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5h2.25a.75.75 0 01.75.75zM17.836 17.836a.75.75 0 01-1.06 0l-1.59-1.591a.75.75 0 111.06-1.06l1.59 1.59a.75.75 0 010 1.06zM12 21.75a.75.75 0 01-.75-.75v-2.25a.75.75 0 011.5 0v2.25a.75.75 0 01-.75-.75zM5.164 17.836a.75.75 0 010-1.06l1.59-1.591a.75.75 0 111.06 1.06l-1.59 1.59a.75.75 0 01-1.06 0zM3 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3.75A.75.75 0 013 12zM6.106 5.106a.75.75 0 011.06 0l1.591 1.59a.75.75 0 01-1.06 1.06l-1.59-1.591a.75.75 0 010-1.06z"/>`;
      document.querySelector('#theme-icon + span').textContent = isDark ? 'Modo Oscuro' : 'Modo Claro';
    }


    // --- INICIALIZACIÓN Y RESPONSIVIDAD ---
    window.addEventListener('resize', () => {
      // Actualizar cámara
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      
      // Actualizar renderizador
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    });

    // Iniciar todo
    init3D();
  </script>
</body>
</html>
