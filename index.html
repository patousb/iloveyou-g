<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para Ti, Mi Universo</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">

    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Montserrat:wght@300;400;600&family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    
    <!-- LibrerÃ­a Three.js para el fondo 3D -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        :root {
            --glow-color: #ff6b6b;
            --primary-color: #f8a5c2;
            --dark-bg: #0a0a1a;
            --card-bg: rgba(20, 20, 40, 0.8);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--dark-bg);
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
            cursor: none;
        }
        
        #preloader {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: var(--dark-bg); z-index: 9999; display: flex;
            justify-content: center; align-items: center; flex-direction: column;
            gap: 1rem; transition: opacity 1s ease, visibility 1s ease 0.5s;
        }
        #preloader.loaded { opacity: 0; visibility: hidden; }
        .loader-heart { font-size: 3rem; color: var(--glow-color); animation: heartbeat 1.5s ease-in-out infinite; }
        .loader-text { font-family: 'Pacifico', cursive; font-size: 1.5rem; color: var(--primary-color); }

        #custom-cursor {
            position: fixed; width: 20px; height: 20px; border: 2px solid var(--primary-color);
            border-radius: 50%; left: 0; top: 0; pointer-events: none;
            transform: translate(-50%, -50%);
            transition: transform 0.1s ease-out, width 0.2s ease, height 0.2s ease, background-color 0.2s ease;
            z-index: 10000;
        }
        #custom-cursor::after { /* Orbe brillante */
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 50px; height: 50px;
            background: radial-gradient(circle, rgba(248, 165, 194, 0.3) 0%, rgba(248, 165, 194, 0) 70%);
            border-radius: 50%;
            transition: opacity 0.3s ease;
        }
        #custom-cursor.pointer { transform: translate(-50%, -50%) scale(1.5); background-color: rgba(255, 107, 107, 0.3); }
        @media (pointer: coarse) { body { cursor: auto; } #custom-cursor { display: none; } }

        /* --- FONDO 3D (THREE.JS CANVAS) --- */
        #bg-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            z-index: -2;
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; position: relative; z-index: 1; }
        h1 {
            font-family: 'Pacifico', cursive; font-size: clamp(3rem, 10vw, 5rem); color: transparent;
            background: linear-gradient(45deg, #ff6b6b, #f8a5c2, #ffcc5c);
            -webkit-background-clip: text; background-clip: text;
            text-shadow: 0 0 15px rgba(255, 107, 107, 0.3);
        }
        .section-title {
            font-family: 'Pacifico', cursive; font-size: clamp(2.2rem, 7vw, 3.2rem);
            color: var(--primary-color); text-align: center; margin-bottom: 3rem; position: relative;
        }
        .section-title::after {
            content: ''; position: absolute; bottom: -10px; left: 50%;
            transform: translateX(-50%); width: 100px; height: 3px;
            background: linear-gradient(90deg, transparent, var(--glow-color), transparent);
        }

        .reveal {
            opacity: 0; transform: translateY(50px);
            transition: opacity 1s cubic-bezier(0.175, 0.885, 0.32, 1.275), transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            will-change: opacity, transform;
        }
        .reveal.visible { opacity: 1; transform: translateY(0); }
        
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2.5rem; }
        .polaroid {
            background: white; padding: 1rem; padding-bottom: 4rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3); border-radius: 5px; border: none;
            cursor: pointer; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.5s ease;
            position: relative; will-change: transform;
        }
        .polaroid:hover { transform: translateY(-15px) rotate(5deg) scale(1.05); box-shadow: 0 25px 40px rgba(0,0,0,0.4); }
        .polaroid-image-placeholder {
            width: 100%; height: 250px; border-radius: 2px;
            background: linear-gradient(45deg, var(--primary-color), var(--glow-color), #ffcc5c);
            background-size: 200% 200%;
            animation: gradient-flow 8s ease infinite;
        }
        @keyframes gradient-flow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .polaroid-caption {
            position: absolute; bottom: 1rem; left: 1rem; right: 1rem;
            font-family: 'Dancing Script', cursive; font-size: 1.5rem; color: #333; text-align: center;
        }
        
        #lightbox {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 10, 26, 0.9); backdrop-filter: blur(10px); z-index: 9000;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        #lightbox.show { opacity: 1; visibility: visible; }
        .lightbox-content { position: relative; max-width: 90vw; max-height: 90vh; transform: scale(0.7); transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #lightbox.show .lightbox-content { transform: scale(1); }
        .lightbox-placeholder { width: 80vw; height: 80vh; max-width: 800px; max-height: 600px; border-radius: 10px; box-shadow: 0 0 50px rgba(255,107,107,0.3); }
        .lightbox-close {
            position: absolute; top: -20px; right: -20px; width: 50px; height: 50px;
            background: var(--glow-color); color: white; border: none; border-radius: 50%;
            font-size: 1.5rem; cursor: pointer; transition: transform 0.3s ease;
            display: flex; justify-content: center; align-items: center;
        }
        .lightbox-close:hover { transform: scale(1.1) rotate(90deg); }

        .music-control { position: fixed; bottom: 2.5rem; right: 2.5rem; z-index: 100; }
        .music-box { position: relative; }
        .music-btn {
            background: linear-gradient(45deg, #ff6b6b, #f8a5c2); border: none; width: 70px; height: 70px;
            border-radius: 50%; color: white; font-size: 1.8rem; cursor: pointer;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3); transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; justify-content: center; align-items: center;
        }
        .music-btn:hover { transform: scale(1.1); }
        .song-list {
            position: absolute; bottom: 85px; right: 0; width: 250px;
            background: rgba(20, 20, 40, 0.95); backdrop-filter: blur(10px);
            border-radius: 15px; list-style: none; padding: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4); transform: translateY(20px) scale(0.9);
            opacity: 0; visibility: hidden; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .music-box.open .song-list { transform: translateY(0) scale(1); opacity: 1; visibility: visible; }
        .song-item {
            color: var(--primary-color); padding: 0.75rem 1rem; border-radius: 10px; cursor: pointer;
            transition: background 0.3s ease, color 0.3s ease; display: flex; align-items: center;
            gap: 1rem; border: none; background: transparent; width: 100%;
            font-family: 'Montserrat', sans-serif; font-size: 1rem;
        }
        .song-item:hover { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; }
        .song-item.playing { color: white; background: var(--glow-color); font-weight: bold; }

        /* --- CHAT MEJORADO --- */
        #chat-toggle {
            position: fixed; bottom: 2.5rem; left: 2.5rem; z-index: 100;
            width: 70px; height: 70px; background: linear-gradient(45deg, var(--primary-color), var(--glow-color));
            border-radius: 50%; border: none; color: white; font-size: 2rem;
            display: flex; justify-content: center; align-items: center; cursor: pointer;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            animation: heartbeat 2s infinite ease-in-out 1s;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #chat-toggle:hover { transform: scale(1.15); animation-play-state: paused; }
        #chat-window {
            position: fixed; bottom: 110px; left: 2.5rem; z-index: 99;
            width: 350px; height: 450px; background: rgba(20, 20, 40, 0.9);
            backdrop-filter: blur(10px); border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4); display: flex; flex-direction: column;
            transform: translateY(20px) scale(0.9); opacity: 0; visibility: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #chat-window.open { transform: translateY(0) scale(1); opacity: 1; visibility: visible; }
        .chat-header { padding: 1rem; text-align: center; font-weight: bold; color: var(--primary-color); border-bottom: 1px solid rgba(255,255,255,0.1); position: relative; }
        .chat-close-btn { position: absolute; top: 50%; right: 1rem; transform: translateY(-50%); background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; opacity: 0.7; transition: opacity 0.3s; }
        .chat-close-btn:hover { opacity: 1; }
        .chat-messages { flex-grow: 1; padding: 1rem; overflow-y: auto; display: flex; flex-direction: column; gap: 0.75rem; }
        .chat-message { max-width: 80%; padding: 0.75rem; border-radius: 15px; line-height: 1.4; opacity: 0; animation: fade-in 0.5s forwards; }
        .chat-message.bot { background: #333; align-self: flex-start; border-bottom-left-radius: 2px; }
        .chat-message.user { background: var(--glow-color); align-self: flex-end; border-bottom-right-radius: 2px; }
        .chat-input-area { padding: 1rem; display: flex; gap: 0.5rem; border-top: 1px solid rgba(255,255,255,0.1); }
        #chat-input { flex-grow: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 0.75rem; border-radius: 10px; }
        #chat-send-btn { background: var(--primary-color); border: none; color: white; padding: 0 1rem; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .typing-indicator { display: flex; align-items: center; gap: 5px; padding: 0.75rem; opacity: 0; transition: opacity 0.3s; height: 34px;}
        .typing-indicator.typing { opacity: 1; }
        .typing-indicator span { width: 8px; height: 8px; background: #777; border-radius: 50%; animation: typing-dots 1s infinite; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing-dots { 0%, 100% { opacity: 0.2; } 50% { opacity: 1; } }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .time-counter { text-align: center; padding: 3rem 2rem; }
        .time-display { display: flex; justify-content: center; flex-wrap: wrap; gap: clamp(1rem, 3vw, 2rem); }
        .time-unit { background: var(--card-bg); border-radius: 15px; padding: 1.5rem 1rem; min-width: 100px; }
        .time-number { font-size: clamp(2rem, 6vw, 3rem); font-weight: bold; color: var(--glow-color); }
        .time-label { font-size: clamp(0.8rem, 2vw, 1rem); color: var(--primary-color); text-transform: uppercase; }
        
        .poem-section { padding: 3rem; text-align: center; }
        .poem-line { font-family: 'Dancing Script', cursive; font-size: 1.8rem; line-height: 1.6; margin-bottom: 1.5rem; opacity: 0.7; transition: all 0.5s ease; }
        .poem-line:hover { opacity: 1; transform: scale(1.05); color: var(--glow-color); }

        .surprise-container { text-align: center; margin: 5rem 0; }
        .surprise-btn {
            background: linear-gradient(45deg, #ff6b6b, #f8a5c2); border: none; color: white;
            padding: 1.5rem 3rem; font-size: clamp(1.2rem, 4vw, 1.5rem); border-radius: 50px;
            cursor: pointer; transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.5); font-family: 'Pacifico', cursive;
        }
        .surprise-btn:hover { transform: translateY(-8px) scale(1.08); }
        
        .confetti { position: fixed; font-size: 1.5rem; opacity: 0; z-index: 9999; animation: confetti-fall 5s linear forwards; }
        @keyframes confetti-fall { 0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(110vh) rotate(720deg); opacity: 0; } }

        .letter, .reason-item, .poem-line { background: none; border: none; padding: 0; text-align: inherit; font-family: inherit; color: inherit; cursor: pointer; width: 100%; }
        .message-section, .letter, .time-counter, .poem-section, .gallery-section, footer { will-change: transform, opacity; }
        .letter {
            width: 320px; background: linear-gradient(135deg, rgba(40, 40, 60, 0.8), rgba(20, 20, 40, 0.9));
            border-radius: 15px; padding: 2rem; transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        .letter:hover { transform: translateY(-10px) scale(1.02); }
        .letter-content { max-height: 0; overflow: hidden; transition: max-height 0.7s ease, opacity 0.5s ease; opacity: 0; }
        .letter.active .letter-content { max-height: 600px; margin-top: 1.5rem; opacity: 1; }
        .letters-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 2.5rem; margin-bottom: 4rem; }
        @keyframes heartbeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        /* --- ESTILOS RESPONSIVOS PARA MÃVIL --- */
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .letter { width: 100%; }
            #chat-toggle { width: 60px; height: 60px; font-size: 1.5rem; bottom: 1.5rem; left: 1.5rem; }
            .music-control { bottom: 1.5rem; right: 1.5rem; }
            .music-btn { width: 60px; height: 60px; }
            #chat-window {
                width: calc(100vw - 3rem);
                height: 70vh;
                left: 1.5rem;
                bottom: 90px;
            }
            .time-display { gap: 0.5rem; }
            .time-unit { min-width: 70px; padding: 1rem 0.5rem; }
        }

        @media (max-width: 576px) {
            .polaroid-image-placeholder { height: 200px; }
            .time-display {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
            }
            .surprise-btn { padding: 1.2rem 2rem; }
            .poem-line { font-size: 1.5rem; }
        }

    </style>
</head>
<body>
    
    <div id="preloader"><div class="loader-heart">â¤ï¸</div><div class="loader-text">Cargando nuestro universo...</div></div>
    <div id="custom-cursor"></div>
    <canvas id="bg-canvas"></canvas>
    <div id="lightbox"><div class="lightbox-content"><div class="polaroid-image-placeholder lightbox-placeholder"></div><button class="lightbox-close" aria-label="Cerrar imagen">&times;</button></div></div>
    
    <div class="music-control">
        <div class="music-box" id="musicBox">
            <button class="music-btn" id="mainMusicBtn" aria-label="Abrir control de mÃºsica"><i class="fas fa-music"></i></button>
            <ul class="song-list" id="songList">
                <li><button class="song-item" data-src="https://cdn.pixabay.com/audio/2022/10/24/audio_9682ac3a17.mp3"><i class="fas fa-play"></i> MelodÃ­a de Estrellas</button></li>
                <li><button class="song-item" data-src="https://cdn.pixabay.com/audio/2023/10/10/audio_2919fd1d23.mp3"><i class="fas fa-play"></i> Nuestro Refugio</button></li>
                <li><button class="song-item" data-src="https://cdn.pixabay.com/audio/2024/04/23/audio_f812a879a8.mp3"><i class="fas fa-play"></i> Amanecer Juntos</button></li>
            </ul>
        </div>
        <audio id="bgMusic" loop></audio>
    </div>

    <button id="chat-toggle" aria-label="Abrir chat"><i class="fa-solid fa-heart"></i></button>
    <div id="chat-window">
        <div class="chat-header">
            Una nota de mi corazÃ³n...
            <button class="chat-close-btn" aria-label="Cerrar chat">&times;</button>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="typing-indicator" id="typingIndicator"><span></span><span></span><span></span></div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="Escribe aquÃ­...">
            <button id="chat-send-btn">Enviar</button>
        </div>
    </div>

    <main class="container" id="home">
        <header class="reveal">
            <h1>Para ti mi Pocoyo</h1>
            <p class="subtitle typewriter">Cada latido de mi corazÃ³n lleva tu nombre</p>
        </header>

        <section class="message-section reveal" id="messages">
            <h2 class="section-title">Mi Mensaje Para Ti</h2>
            <div class="message-content">
                <p>Desde el momento en que nuestros caminos se cruzaron, mi vida cobrÃ³ un nuevo significado. Cada dÃ­a a tu lado es un regalo que atesoro profundamente en mi corazÃ³n, como las estrellas que brillan en la noche mÃ¡s oscura.</p>
            </div>
        </section>

        <section class="gallery-section reveal" id="gallery">
            <h2 class="section-title">GalerÃ­a de Nuestros Momentos</h2>
            <div class="gallery-grid">
                <button class="polaroid"><div class="polaroid-image-placeholder"></div><p class="polaroid-caption">Nuestro Comienzo</p></button>
                <button class="polaroid"><div class="polaroid-image-placeholder"></div><p class="polaroid-caption">Aquel Viaje</p></button>
                <button class="polaroid"><div class="polaroid-image-placeholder"></div><p class="polaroid-caption">Una Tarde Perfecta</p></button>
            </div>
        </section>

        <section class="reveal" id="letters">
            <h2 class="section-title">Cartas Para Ti</h2>
            <div class="letters-container">
                <button class="letter"><h3 class="letter-header">Cuando te vi o me enamorÃ©</h3><div class="letter-content"><p>el 31 de diciembre fue el momento mas hermoso que pude haber tenido en mi vida, ya que vi lo hermosa que eres con ese vestido tan lindo tan espectacular, que no pude dejar de mirarte por un segundo y pudo que te haya visto en video llamada a travez de una pantalla pero fue lo mas hermoso que pude haber visto, y claro hay muchos momentos como la presentacion en colombianitos a bailar donde estuvimos mas tiempo juntos son los mas hermosos  momentos y enamoramiento que pudimos tener</p></div></button>
                <button class="letter"><h3 class="letter-header">Lo Que Amo de Ti</h3><div class="letter-content"><p>lo que amo de ti no es solo una cosa, son varias cosas de la cual amo de ti , no fue tu fisico, aunque eres hermosa, fue en como me hiciste sentir, tu sonrisa, tus labios, tu forma de hablar, la forma en como bailas y mueves esa cintura es algo espectacular, tus ojos cuando me miran es algo inevitable de no mirar, amo como me haces sentir ya que tu eres alguien muy importante para mi, amo como eres conmigo, puedes decirme hay muchas chicas mejores que yo, pero no hay nadie como tu las demas son las demas pero tu. eres tu. y eres tu a quien yo elijo y amo.</p></div></button>
            </div>
        </section>

        <section class="time-counter reveal" id="counter">
            <h2 class="section-title">Nuestro Tiempo Juntos</h2>
            <div class="time-display">
                <div class="time-unit"><div class="time-number" id="years">3</div><div class="time-label">AÃ±os</div></div>
                <div class="time-unit"><div class="time-number" id="days">0</div><div class="time-label">DÃ­as</div></div>
                <div class="time-unit"><div class="time-number" id="hours">30</div><div class="time-label">Horas</div></div>
                <div class="time-unit"><div class="time-number" id="minutes">20</div><div class="time-label">Minutos</div></div>
                <div class="time-unit"><div class="time-number" id="seconds">10</div><div class="time-label">Segundos</div></div>
            </div>
        </section>

        <section class="poem-section reveal" id="poem">
            <h2 class="section-title">Un Verso Para Ti</h2>
            <div class="poem-content">
                <button class="poem-line">eres el jardin para mis ojos no vez en la forma en como te miro,</button>
                <button class="poem-line">haces que mis ojos se sientan tranquilo cuando los vez fijamente,</button>
                <button class="poem-line">no se si duraremos para siempre pero que te quiero para siempre eso si lo se.</button>
                <button class="poem-line">es una locura lo que siento por ti. te amo por una razon y te quiero por un proposito.</button>
            </div>
        </section>

        <section class="surprise-container reveal" id="surprise">
            <button class="surprise-btn"><i class="fas fa-gift"></i> Una Sorpresa Final</button>
        </section>

    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- PRELOADER ---
        window.addEventListener('load', () => {
            document.getElementById('preloader').classList.add('loaded');
        });

        // --- CURSOR PERSONALIZADO ---
        const cursor = document.getElementById('custom-cursor');
        if (window.matchMedia("(pointer: fine)").matches) {
            document.addEventListener('mousemove', e => {
                cursor.style.left = `${e.clientX}px`;
                cursor.style.top = `${e.clientY}px`;
            });
            document.querySelectorAll('a, button, .polaroid, .song-item, .letter, .poem-line').forEach(el => {
                el.addEventListener('mouseenter', () => cursor.classList.add('pointer'));
                el.addEventListener('mouseleave', () => cursor.classList.remove('pointer'));
            });
        }

        // --- FONDO 3D CON THREE.JS ---
        let scene, camera, renderer, stars, heart;
        const mouse = new THREE.Vector2();

        function init3DBackground() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 50;
            
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg-canvas'), alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);

            // Estrellas
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.1 });
            const starVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starVertices.push(x, y, z);
            }
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);

            // CorazÃ³n de Nebulosa
            const heartShape = new THREE.Shape();
            heartShape.moveTo(2.5, 2.5);
            heartShape.bezierCurveTo(2.5, 2.5, 2, 0, 0, 0);
            heartShape.bezierCurveTo(-3, 0, -3, 3.5, -3, 3.5);
            heartShape.bezierCurveTo(-3, 5.5, -1, 7.7, 2.5, 9.5);
            heartShape.bezierCurveTo(6, 7.7, 8, 5.5, 8, 3.5);
            heartShape.bezierCurveTo(8, 3.5, 8, 0, 5, 0);
            heartShape.bezierCurveTo(3.5, 0, 2.5, 2.5, 2.5, 2.5);
            
            const extrudeSettings = { depth: 2, bevelEnabled: true, bevelSegments: 2, steps: 2, bevelSize: 1, bevelThickness: 1 };
            const heartGeometry = new THREE.ExtrudeGeometry(heartShape, extrudeSettings);
            const heartMaterial = new THREE.MeshStandardMaterial({
                color: 0xff0000,
                emissive: 0xff0000,
                emissiveIntensity: 0.5,
                metalness: 0.5,
                roughness: 0.5
            });
            heart = new THREE.Mesh(heartGeometry, heartMaterial);
            heart.position.set(-2.5, -5, 0);
            scene.add(heart);

            const pointLight = new THREE.PointLight(0xffffff, 1, 100);
            pointLight.position.set(10, 10, 10);
            scene.add(pointLight);

            animate3D();
        }

        function animate3D() {
            requestAnimationFrame(animate3D);
            stars.rotation.y += 0.0001;
            heart.rotation.y += 0.005;
            heart.material.emissiveIntensity = Math.sin(Date.now() * 0.002) * 0.5 + 0.5;

            // Parallax effect
            if (window.matchMedia("(pointer: fine)").matches) {
                camera.position.x += (mouse.x * 5 - camera.position.x) * 0.05;
                camera.position.y += (-mouse.y * 5 - camera.position.y) * 0.05;
                camera.lookAt(scene.position);
            }

            renderer.render(scene, camera);
        }
        
        if (window.matchMedia("(pointer: fine)").matches) {
            document.body.addEventListener('mousemove', (event) => {
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = (event.clientY / window.innerHeight) * 2 - 1;
            });
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        init3DBackground();
        
        // --- ANIMACIONES AL HACER SCROLL ---
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        
        // --- CAJA DE MÃSICA ---
        const musicBox = document.getElementById('musicBox');
        const mainMusicBtn = document.getElementById('mainMusicBtn');
        const bgMusic = document.getElementById('bgMusic');
        const songItems = document.querySelectorAll('.song-item');
        mainMusicBtn.addEventListener('click', () => musicBox.classList.toggle('open'));
        songItems.forEach(item => {
            item.addEventListener('click', () => { playSong(item); musicBox.classList.remove('open'); });
        });
        function playSong(selectedItem) {
            const src = selectedItem.dataset.src;
            if (bgMusic.src !== src) bgMusic.src = src;
            bgMusic.play();
            mainMusicBtn.querySelector('i').className = 'fas fa-pause';
            songItems.forEach(i => { i.classList.remove('playing'); i.querySelector('i').className = 'fas fa-play'; });
            selectedItem.classList.add('playing'); selectedItem.querySelector('i').className = 'fas fa-headphones';
        }
        bgMusic.addEventListener('play', () => mainMusicBtn.querySelector('i').className = 'fas fa-pause');
        bgMusic.addEventListener('pause', () => mainMusicBtn.querySelector('i').className = 'fas fa-music');

        // --- GALERÃA Y LIGHTBOX ---
        const lightbox = document.getElementById('lightbox');
        document.querySelectorAll('.polaroid').forEach(p => p.addEventListener('click', () => lightbox.classList.add('show')));
        document.querySelector('.lightbox-close').addEventListener('click', () => lightbox.classList.remove('show'));
        lightbox.addEventListener('click', e => { if (e.target === lightbox) lightbox.classList.remove('show'); });

        // --- CARTAS INTERACTIVAS ---
        document.querySelectorAll('.letter').forEach(b => b.addEventListener('click', () => toggleLetter(b)));
        function toggleLetter(letter) {
            const isActive = letter.classList.contains('active');
            document.querySelectorAll('.letter.active').forEach(l => l.classList.remove('active'));
            if (!isActive) letter.classList.add('active');
        }
        
        // --- CONTADOR DE TIEMPO ---
        const now = new Date();
        const yearsInMs = 3 * 365.25 * 24 * 60 * 60 * 1000;
        const hoursInMs = 30 * 60 * 60 * 1000;
        const minutesInMs = 20 * 60 * 1000;
        const secondsInMs = 10 * 1000;
        const totalOffset = yearsInMs + hoursInMs + minutesInMs + secondsInMs;
        const startDate = new Date(now.getTime() - totalOffset);

        function updateTimeCounter() {
            const current = new Date();
            const diff = current - startDate;
            const s = Math.floor(diff / 1000);
            const m = Math.floor(s / 60);
            const h = Math.floor(m / 60);
            const d = Math.floor(h / 24);
            const y = Math.floor(d / 365.25);
            document.getElementById('seconds').textContent = s % 60;
            document.getElementById('minutes').textContent = m % 60;
            document.getElementById('hours').textContent = h % 24;
            document.getElementById('days').textContent = Math.floor(d % 365.25);
            document.getElementById('years').textContent = y;
        }
        setInterval(updateTimeCounter, 1000);
        updateTimeCounter();

        // --- BOTÃN DE SORPRESA ---
        document.querySelector('.surprise-btn').addEventListener('click', () => {
            for (let i = 0; i < 100; i++) {
                const c = document.createElement('div'); c.classList.add('confetti');
                c.textContent = 'â¤ï¸'; c.style.left = `${Math.random() * 100}vw`;
                c.style.animationDelay = `${Math.random() * 2}s`;
                document.body.appendChild(c); setTimeout(() => c.remove(), 5000);
            }
        });

        // --- LÃGICA DEL CHAT ---
        const chatToggle = document.getElementById('chat-toggle');
        const chatWindow = document.getElementById('chat-window');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chat-input');
        const chatSendBtn = document.getElementById('chat-send-btn');
        const typingIndicator = document.getElementById('typingIndicator');
        const chatCloseBtn = document.querySelector('.chat-close-btn');

        const responses = {
            default: "Eso es muy lindo. â¤ï¸ Sigue contÃ¡ndome mÃ¡s.",
            hola: "Â¡Hola, mi amor! QuÃ© alegrÃ­a leerte. ð",
            "cÃ³mo estÃ¡s": "Estoy feliz, porque estÃ¡s aquÃ­ conmigo.",
            "te amo": "Y yo a ti, mÃ¡s de lo que las palabras pueden expresar. â¤ï¸",
            "te quiero": "Yo te quiero hasta el infinito y mÃ¡s allÃ¡.",
            cita: "Recuerdo nuestra primera cita como si fuera ayer. Fue un momento mÃ¡gico.",
            recuerdo: "Amo todos nuestros recuerdos. Cada uno es un tesoro.",
            gracias: "Gracias a ti por ser la persona mÃ¡s increÃ­ble del mundo."
        };

        chatToggle.addEventListener('click', () => {
            chatWindow.classList.toggle('open');
            if (chatWindow.classList.contains('open') && chatMessages.children.length === 0) {
                showBotMessage("Escribe algo para mÃ­...");
            }
        });
        chatCloseBtn.addEventListener('click', () => chatWindow.classList.remove('open'));
        chatSendBtn.addEventListener('click', handleUserMessage);
        chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleUserMessage(); });

        function handleUserMessage() {
            const text = chatInput.value.trim();
            if (text === '') return;

            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user';
            userMessage.textContent = text;
            chatMessages.appendChild(userMessage);
            chatInput.value = '';
            chatMessages.scrollTop = chatMessages.scrollHeight;

            let botResponse = responses.default;
            for (const key in responses) {
                if (text.toLowerCase().includes(key)) {
                    botResponse = responses[key];
                    break;
                }
            }
            showBotMessage(botResponse);
        }

        function showBotMessage(message) {
            typingIndicator.classList.add('typing');
            setTimeout(() => {
                typingIndicator.classList.remove('typing');
                const botMessage = document.createElement('div');
                botMessage.className = 'chat-message bot';
                botMessage.textContent = message;
                chatMessages.appendChild(botMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1500);
        }
    });
    </script>
</body>
</html>
